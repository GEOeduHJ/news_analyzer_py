import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from wordcloud import WordCloud
from collections import Counter
from collections import Counter, defaultdict
import networkx as nx
import re
import folium
from folium.plugins import HeatMap
from streamlit_folium import folium_static
import matplotlib.pyplot as plt
import os
import json
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# WordCloudì— ì‚¬ìš©í•  í°íŠ¸ ê²½ë¡œ ì„¤ì •
import os
import platform

# Windowsì—ì„œ Malgun Gothic í°íŠ¸ì˜ ê²½ë¡œ
if platform.system() == 'Windows':
    font_path = os.path.join(os.environ['WINDIR'], 'Fonts', 'malgun.ttf')
else:
    # ë‹¤ë¥¸ ì‹œìŠ¤í…œì—ì„œëŠ” ê¸°ë³¸ í°íŠ¸ ì‚¬ìš©
    font_path = None

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ë‰´ìŠ¤ ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ",
    page_icon="ğŸ“Š",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ì œëª©
st.title("ğŸ“° ë‰´ìŠ¤ ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ")

# íŒŒì¼ ì—…ë¡œë“œ
uploaded_file = st.file_uploader("ë‰´ìŠ¤ ë°ì´í„° íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (xlsx)", type=["xlsx"])

# ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜
def process_data(uploaded_file):
    try:
        # ì—‘ì…€ íŒŒì¼ ë¡œë“œ
        news_df = pd.read_excel(uploaded_file, engine='openpyxl')
        
        # ì»¬ëŸ¼ ì´ë¦„ ë§¤í•‘
        column_mapping = {
            "ì¼ì": "ì‘ì„±/ê²Œì‹œì¼ì",
            "ì œëª©": "ê¸°ì‚¬ì œëª©",
            "ê¸°ê´€": "ê´€ë ¨ê¸°ê´€",
            "íŠ¹ì„±ì¶”ì¶œ(ê°€ì¤‘ì¹˜ìˆœ ìƒìœ„ 50ê°œ)": "í‚¤ì›Œë“œ",
            "URL": "ê¸°ì‚¬ë§í¬"
        }
        
        # ê¸°ì¡´ ì»¬ëŸ¼ ì¤‘ ë§¤í•‘ëœ ì»¬ëŸ¼ë§Œ ì„ íƒ
        existing_columns = [col for col in column_mapping.keys() if col in news_df.columns]
        news_df = news_df[existing_columns]
        
        # ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½
        news_df = news_df.rename(columns=column_mapping)
        
        # ì¤‘ë³µ ì»¬ëŸ¼ ì œê±°
        news_df = news_df.loc[:, ~news_df.columns.duplicated()]
        
        # 'ì¼ì' ì»¬ëŸ¼ì—ì„œ 'ì—°ë„' ì»¬ëŸ¼ ìƒì„±
        if 'ì‘ì„±/ê²Œì‹œì¼ì' in news_df.columns:
            try:
                # yyyymmdd í˜•ì‹ì—ì„œ ì•ì˜ 4ìë¦¬(ì—°ë„) ì¶”ì¶œ
                news_df['ì—°ë„'] = news_df['ì‘ì„±/ê²Œì‹œì¼ì'].astype(str).str[:4]
            except Exception as e:
                st.error(f"'ì¼ì' ì»¬ëŸ¼ì—ì„œ ì—°ë„ë¥¼ ì¶”ì¶œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
                raise
        else:
            st.error("íŒŒì¼ì— 'ì¼ì' ì»¬ëŸ¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¶„ì„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            raise ValueError("ì¼ì ì»¬ëŸ¼ ì—†ìŒ")
            
        return news_df
    except Exception as e:
        st.error(f"íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
        raise

if uploaded_file is not None:
    try:
        # ë°ì´í„° ì²˜ë¦¬
        news_df = process_data(uploaded_file)
        
        # ë°ì´í„° í‘œì‹œ
        st.markdown("---")
        st.header("ğŸ“Š ë°ì´í„° íƒìƒ‰")
        
        # ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
        search_text = st.text_input("ê²€ìƒ‰ì–´ ì…ë ¥", "")
    except Exception as e:
        st.error(f"ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
        st.info("ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ë¶„ì„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
        raise
        
    if search_text:
            # ëª¨ë“  í…ìŠ¤íŠ¸ ì»¬ëŸ¼ì—ì„œ ê²€ìƒ‰ì–´ê°€ í¬í•¨ëœ ë°ì´í„° í•„í„°ë§
            filtered_df = news_df[
                news_df.apply(
                    lambda row: any(search_text.lower() in str(cell).lower() 
                                   for cell in row if pd.notna(cell)),
                    axis=1
                )
            ]
            
            if len(filtered_df) == 0:
                st.warning(f"'{search_text}'ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
            else:
                st.write(f"ê²€ìƒ‰ ê²°ê³¼: {len(filtered_df)}ê±´")
                display_df = filtered_df
    else:
        display_df = news_df
        
    # ë°ì´í„° í‘œì‹œ ì„¤ì •
    st.dataframe(
        display_df[["ì‘ì„±/ê²Œì‹œì¼ì", "ê¸°ì‚¬ì œëª©", "ê´€ë ¨ê¸°ê´€", "í‚¤ì›Œë“œ", "ê¸°ì‚¬ë§í¬"]].head(50),
        use_container_width=True
    )
        
    # ì§€ëª… ë¹ˆë„ìˆ˜ íˆíŠ¸ë§µ
    st.markdown("---")
    st.header("ğŸ—ºï¸ ë¶„ì„ 0: ì§€ëª… ë¹ˆë„ìˆ˜ íˆíŠ¸ë§µ")
    
    if 'í‚¤ì›Œë“œ' in display_df.columns:
        # ì‹œêµ°êµ¬ ì¢Œí‘œ ë°ì´í„°ë¥¼ ì§ì ‘ ì •ì˜
        @st.cache_data
        def load_sigungu_coordinates():
            """ì‹œêµ°êµ¬ ì¢Œí‘œ ë°ì´í„°ë¥¼ ë¡œë“œ"""
            try:
                # ì‹œêµ°êµ¬ ì¢Œí‘œ ë°ì´í„° (ì§ì ‘ ì •ì˜)
                coords_dict = {
  "ì¶˜ì²œì‹œ": {
    "lat": 37.8907502944142,
    "lon": 127.73855024742944
  },
  "ì›ì£¼ì‹œ": {
    "lat": 37.30827214389988,
    "lon": 127.93010148359669
  },
  "ê°•ë¦‰ì‹œ": {
    "lat": 37.70909757680244,
    "lon": 128.83629661662167
  },
  "ë™í•´ì‹œ": {
    "lat": 37.507699146772026,
    "lon": 129.05750815396124
  },
  "íƒœë°±ì‹œ": {
    "lat": 37.17355382230187,
    "lon": 128.98028444413865
  },
  "ì†ì´ˆì‹œ": {
    "lat": 38.17460699655262,
    "lon": 128.5170283057989
  },
  "ì‚¼ì²™ì‹œ": {
    "lat": 37.27940030984353,
    "lon": 129.11945855070846
  },
  "í™ì²œêµ°": {
    "lat": 37.745371983968425,
    "lon": 128.0718188529946
  },
  "íš¡ì„±êµ°": {
    "lat": 37.50979568781028,
    "lon": 128.07714655993058
  },
  "ì˜ì›”êµ°": {
    "lat": 37.20365761082058,
    "lon": 128.5007363393495
  },
  "í‰ì°½êµ°": {
    "lat": 37.55952175453339,
    "lon": 128.4839378899835
  },
  "ì •ì„ êµ°": {
    "lat": 37.37954498871875,
    "lon": 128.736643231494
  },
  "ì² ì›êµ°": {
    "lat": 38.23985557501652,
    "lon": 127.39553990592204
  },
  "í™”ì²œêµ°": {
    "lat": 38.13775940152845,
    "lon": 127.68466235514624
  },
  "ì–‘êµ¬êµ°": {
    "lat": 38.17516332931209,
    "lon": 127.99809563638968
  },
  "ì¸ì œêµ°": {
    "lat": 38.065852635216366,
    "lon": 128.26556442674826
  },
  "ê³ ì„±êµ°": {
    "lat": 35.016863611674,
    "lon": 128.29527118964077
  },
  "ì–‘ì–‘êµ°": {
    "lat": 38.00454775494876,
    "lon": 128.5963809162701
  },
  "ì¥ì•ˆêµ¬": {
    "lat": 37.31396485048892,
    "lon": 127.00322224854732
  },
  "ê¶Œì„ êµ¬": {
    "lat": 37.26162810834032,
    "lon": 126.97987706528563
  },
  "íŒ”ë‹¬êµ¬": {
    "lat": 37.27884128987851,
    "lon": 127.01638583032246
  },
  "ì˜í†µêµ¬": {
    "lat": 37.27422255144783,
    "lon": 127.05332283278976
  },
  "ìˆ˜ì •êµ¬": {
    "lat": 37.434236154404296,
    "lon": 127.1034291981654
  },
  "ì¤‘ì›êµ¬": {
    "lat": 37.43393959749726,
    "lon": 127.1630745575102
  },
  "ë¶„ë‹¹êµ¬": {
    "lat": 37.37817354595352,
    "lon": 127.10522691772942
  },
  "ì˜ì •ë¶€ì‹œ": {
    "lat": 37.73619730554574,
    "lon": 127.0670189089998
  },
  "ì•ˆì–‘ì‹œë§Œì•ˆêµ¬": {
    "lat": 37.403885152929206,
    "lon": 126.911729272389
  },
  "ì•ˆì–‘ì‹œë™ì•ˆêµ¬": {
    "lat": 37.40139490855061,
    "lon": 126.95643278057705
  },
  "ë¶€ì²œì‹œ": {
    "lat": 37.50522462023604,
    "lon": 126.7904649625358
  },
  "ê´‘ëª…ì‹œ": {
    "lat": 37.446200498704,
    "lon": 126.8625286355182
  },
  "í‰íƒì‹œ": {
    "lat": 37.01068236511996,
    "lon": 126.98700016798088
  },
  "ë™ë‘ì²œì‹œ": {
    "lat": 37.91671220772368,
    "lon": 127.07781784130871
  },
  "ì•ˆì‚°ì‹œìƒë¡êµ¬": {
    "lat": 37.31860875318384,
    "lon": 126.87300219812454
  },
  "ì•ˆì‚°ì‹œë‹¨ì›êµ¬": {
    "lat": 37.52796410994512,
    "lon": 127.26693141604696
  },
  "ê³ ì–‘ì‹œë•ì–‘êµ¬": {
    "lat": 37.65492277017285,
    "lon": 126.88019242261728
  },
  "ê³ ì–‘ì‹œì¼ì‚°ë™êµ¬": {
    "lat": 37.67902616693949,
    "lon": 126.79746135506062
  },
  "ê³ ì–‘ì‹œì¼ì‚°ì„œêµ¬": {
    "lat": 37.68085153316388,
    "lon": 126.72620011421677
  },
  "ê³¼ì²œì‹œ": {
    "lat": 37.43231027806656,
    "lon": 127.0064804945684
  },
  "êµ¬ë¦¬ì‹œ": {
    "lat": 37.59626868754476,
    "lon": 127.13173213408334
  },
  "ë‚¨ì–‘ì£¼ì‹œ": {
    "lat": 37.66376958720197,
    "lon": 127.24116459316475
  },
  "ì˜¤ì‚°ì‹œ": {
    "lat": 37.16322521948571,
    "lon": 127.05215305867264
  },
  "ì‹œí¥ì‹œ": {
    "lat": 37.38900482051256,
    "lon": 126.78719963286376
  },
  "êµ°í¬ì‹œ": {
    "lat": 37.344281230131365,
    "lon": 126.92514007145316
  },
  "ì˜ì™•ì‹œ": {
    "lat": 37.36203120919595,
    "lon": 126.990096388102
  },
  "í•˜ë‚¨ì‹œ": {
    "lat": 37.52045955405907,
    "lon": 127.20393343514904
  },
  "ìš©ì¸ì‹œì²˜ì¸êµ¬": {
    "lat": 37.20679625043835,
    "lon": 127.24990044556256
  },
  "ìš©ì¸ì‹œê¸°í¥êµ¬": {
    "lat": 37.26672185641,
    "lon": 127.1195778241828
  },
  "ìš©ì¸ì‹œìˆ˜ì§€êµ¬": {
    "lat": 37.33281914094321,
    "lon": 127.0702202325529
  },
  "íŒŒì£¼ì‹œ": {
    "lat": 37.85600239962601,
    "lon": 126.81255683726994
  },
  "ì´ì²œì‹œ": {
    "lat": 37.20706128532365,
    "lon": 127.48049856818844
  },
  "ì•ˆì„±ì‹œ": {
    "lat": 37.03389187453632,
    "lon": 127.30246925162368
  },
  "ê¹€í¬ì‹œ": {
    "lat": 37.680627473672914,
    "lon": 126.62642298189238
  },
  "í™”ì„±ì‹œ": {
    "lat": 37.16482956994478,
    "lon": 126.87339687869596
  },
  "ê´‘ì£¼ì‹œ": {
    "lat": 37.404450030613575,
    "lon": 127.30268236367672
  },
  "ì–‘ì£¼ì‹œ": {
    "lat": 37.81000704061461,
    "lon": 127.00323756671858
  },
  "í¬ì²œì‹œ": {
    "lat": 37.9736971764198,
    "lon": 127.25209888131651
  },
  "ì—¬ì£¼ì‹œ": {
    "lat": 37.30404354451096,
    "lon": 127.61537735285752
  },
  "ì—°ì²œêµ°": {
    "lat": 38.09161800631988,
    "lon": 127.02434936058864
  },
  "ê°€í‰êµ°": {
    "lat": 37.81788827737884,
    "lon": 127.4483909411812
  },
  "ì–‘í‰êµ°": {
    "lat": 37.51843906690636,
    "lon": 127.57589149638748
  },
  "ì˜ì°½êµ¬": {
    "lat": 35.31232454784483,
    "lon": 128.64967174955456
  },
  "ì„±ì‚°êµ¬": {
    "lat": 35.19871988040746,
    "lon": 128.6742461647883
  },
  "ë§ˆì‚°í•©í¬êµ¬": {
    "lat": 35.138355967347366,
    "lon": 128.48252440512871
  },
  "ë§ˆì‚°íšŒì›êµ¬": {
    "lat": 35.232852397212305,
    "lon": 128.53408754179893
  },
  "ì§„í•´êµ¬": {
    "lat": 35.129877701622,
    "lon": 128.73989914938824
  },
  "ì§„ì£¼ì‹œ": {
    "lat": 35.206544753448114,
    "lon": 128.12609271157532
  },
  "í†µì˜ì‹œ": {
    "lat": 34.9602477837962,
    "lon": 128.4281554826381
  },
  "ì‚¬ì²œì‹œ": {
    "lat": 35.05139368642952,
    "lon": 128.0402941918309
  },
  "ê¹€í•´ì‹œ": {
    "lat": 35.270946015644085,
    "lon": 128.84651605170973
  },
  "ë°€ì–‘ì‹œ": {
    "lat": 35.49826761272739,
    "lon": 128.7873196954975
  },
  "ê±°ì œì‹œ": {
    "lat": 34.866266999598786,
    "lon": 128.6197335021494
  },
  "ì–‘ì‚°ì‹œ": {
    "lat": 35.402140910580634,
    "lon": 129.04040629012525
  },
  "ì˜ë ¹êµ°": {
    "lat": 35.39231831535562,
    "lon": 128.27709824399133
  },
  "í•¨ì•ˆêµ°": {
    "lat": 35.291331593557686,
    "lon": 128.43010811894683
  },
  "ì°½ë…•êµ°": {
    "lat": 35.50921745576266,
    "lon": 128.49292933986155
  },
  "ë‚¨í•´êµ°": {
    "lat": 34.796690416299455,
    "lon": 127.90734336444626
  },
  "í•˜ë™êµ°": {
    "lat": 35.13826757344309,
    "lon": 127.77760029099052
  },
  "ì‚°ì²­êµ°": {
    "lat": 35.36886845792488,
    "lon": 127.88557450494412
  },
  "í•¨ì–‘êµ°": {
    "lat": 35.55384486864036,
    "lon": 127.7226647555179
  },
  "ê±°ì°½êµ°": {
    "lat": 35.73283280870575,
    "lon": 127.90449110040171
  },
  "í•©ì²œêµ°": {
    "lat": 35.57620863614838,
    "lon": 128.14220357461588
  },
  "ë‚¨êµ¬": {
    "lat": 35.51703201513299,
    "lon": 129.33123504097898
  },
  "ë¶êµ¬": {
    "lat": 35.61007506150729,
    "lon": 129.37963250576814
  },
  "ê²½ì£¼ì‹œ": {
    "lat": 35.82851022928526,
    "lon": 129.23476872051808
  },
  "ê¹€ì²œì‹œ": {
    "lat": 36.06416818527858,
    "lon": 128.07895260021033
  },
  "ì•ˆë™ì‹œ": {
    "lat": 36.58117835044659,
    "lon": 128.78190102442738
  },
  "êµ¬ë¯¸ì‹œ": {
    "lat": 36.207894175066976,
    "lon": 128.3585528280437
  },
  "ì˜ì£¼ì‹œ": {
    "lat": 36.87112334654928,
    "lon": 128.5958617527594
  },
  "ì˜ì²œì‹œ": {
    "lat": 36.016072766713634,
    "lon": 128.94037080539204
  },
  "ìƒì£¼ì‹œ": {
    "lat": 36.42998993075332,
    "lon": 128.0662996426512
  },
  "ë¬¸ê²½ì‹œ": {
    "lat": 36.69114841044764,
    "lon": 128.15086675306785
  },
  "ê²½ì‚°ì‹œ": {
    "lat": 35.835693488089525,
    "lon": 128.80974390764428
  },
  "êµ°ìœ„êµ°": {
    "lat": 36.17008046203495,
    "lon": 128.6477900492677
  },
  "ì˜ì„±êµ°": {
    "lat": 36.36143281049499,
    "lon": 128.61883529114533
  },
  "ì²­ì†¡êµ°": {
    "lat": 36.357046010015154,
    "lon": 129.057141728659
  },
  "ì˜ì–‘êµ°": {
    "lat": 36.6949527205354,
    "lon": 129.1434174540719
  },
  "ì˜ë•êµ°": {
    "lat": 36.48181335867197,
    "lon": 129.31792842448868
  },
  "ì²­ë„êµ°": {
    "lat": 35.67324707364347,
    "lon": 128.7857934852976
  },
  "ê³ ë ¹êµ°": {
    "lat": 35.735369942463684,
    "lon": 128.30416575625685
  },
  "ì„±ì£¼êµ°": {
    "lat": 35.90824796539297,
    "lon": 128.23191760753923
  },
  "ì¹ ê³¡êµ°": {
    "lat": 36.015681391514185,
    "lon": 128.4613013104463
  },
  "ì˜ˆì²œêµ°": {
    "lat": 36.6510755762577,
    "lon": 128.42254745389164
  },
  "ë´‰í™”êµ°": {
    "lat": 36.93369419408296,
    "lon": 128.91277878909182
  },
  "ìš¸ì§„êµ°": {
    "lat": 36.90459921719136,
    "lon": 129.3111737614945
  },
  "ìš¸ë¦‰êµ°": {
    "lat": 37.50231064973898,
    "lon": 130.86050905549277
  },
  "ë™êµ¬": {
    "lat": 37.48170978664167,
    "lon": 126.64377577568258
  },
  "ì„œêµ¬": {
    "lat": 37.55760545100642,
    "lon": 126.65875260943754
  },
  "ê´‘ì‚°êµ¬": {
    "lat": 35.16467726243392,
    "lon": 126.7501967453198
  },
  "ì¤‘êµ¬": {
    "lat": 37.479388756128536,
    "lon": 126.44538433256218
  },
  "ìˆ˜ì„±êµ¬": {
    "lat": 35.833450308581206,
    "lon": 128.65949008781337
  },
  "ë‹¬ì„œêµ¬": {
    "lat": 35.82716724401521,
    "lon": 128.52891150529214
  },
  "ë‹¬ì„±êµ°": {
    "lat": 35.689667397774954,
    "lon": 128.5255499483045
  },
  "ìœ ì„±êµ¬": {
    "lat": 36.37968678653291,
    "lon": 127.33622288367712
  },
  "ëŒ€ë•êµ¬": {
    "lat": 36.41663639588057,
    "lon": 127.4420928164686
  },
  "ë¶€ì‚°ì§„êµ¬": {
    "lat": 35.16372190233443,
    "lon": 129.04252470861604
  },
  "ë™ë˜êµ¬": {
    "lat": 35.20326022722132,
    "lon": 129.0808539747662
  },
  "í•´ìš´ëŒ€êµ¬": {
    "lat": 35.196195892954336,
    "lon": 129.1549174682266
  },
  "ì‚¬í•˜êµ¬": {
    "lat": 35.09385812595978,
    "lon": 128.97195189058598
  },
  "ê¸ˆì •êµ¬": {
    "lat": 35.2595241937298,
    "lon": 129.09325162920206
  },
  "ê°•ì„œêµ¬": {
    "lat": 37.56186978699498,
    "lon": 126.82566770777774
  },
  "ì—°ì œêµ¬": {
    "lat": 35.17787570663703,
    "lon": 129.08362449375278
  },
  "ìˆ˜ì˜êµ¬": {
    "lat": 35.16127645824772,
    "lon": 129.11182719765745
  },
  "ì‚¬ìƒêµ¬": {
    "lat": 35.16277459525929,
    "lon": 128.98969511568666
  },
  "ê¸°ì¥êµ°": {
    "lat": 35.30166448647811,
    "lon": 129.201986214536
  },
  "ì¢…ë¡œêµ¬": {
    "lat": 37.59446375034286,
    "lon": 126.97844273422751
  },
  "ìš©ì‚°êµ¬": {
    "lat": 37.53058863020561,
    "lon": 126.9784805209122
  },
  "ì„±ë™êµ¬": {
    "lat": 37.54920970923639,
    "lon": 127.04056253356858
  },
  "ê´‘ì§„êµ¬": {
    "lat": 37.54831760030002,
    "lon": 127.08664293895676
  },
  "ë™ëŒ€ë¬¸êµ¬": {
    "lat": 37.581378576424775,
    "lon": 127.05422835430224
  },
  "ì¤‘ë‘êµ¬": {
    "lat": 37.59712357387402,
    "lon": 127.09146588655774
  },
  "ì„±ë¶êµ¬": {
    "lat": 37.60571665591892,
    "lon": 127.01755738229808
  },
  "ê°•ë¶êµ¬": {
    "lat": 37.64226476054209,
    "lon": 127.01118085815442
  },
  "ë„ë´‰êµ¬": {
    "lat": 37.66808245399668,
    "lon": 127.03233526682952
  },
  "ë…¸ì›êµ¬": {
    "lat": 37.650025755961295,
    "lon": 127.07541964378458
  },
  "ì€í‰êµ¬": {
    "lat": 37.619224355567255,
    "lon": 126.92587753102518
  },
  "ì„œëŒ€ë¬¸êµ¬": {
    "lat": 37.57845051844033,
    "lon": 126.93915290118034
  },
  "ë§ˆí¬êµ¬": {
    "lat": 37.560386497598365,
    "lon": 126.90636517167935
  },
  "ì–‘ì²œêµ¬": {
    "lat": 37.52604459229557,
    "lon": 126.85359499921948
  },
  "êµ¬ë¡œêµ¬": {
    "lat": 37.49671695797304,
    "lon": 126.85866623045672
  },
  "ê¸ˆì²œêµ¬": {
    "lat": 37.45987210562151,
    "lon": 126.90135000345822
  },
  "ì˜ë“±í¬êµ¬": {
    "lat": 37.52226409863389,
    "lon": 126.90990611335108
  },
  "ë™ì‘êµ¬": {
    "lat": 37.49926262560018,
    "lon": 126.95114855188169
  },
  "ê´€ì•…êµ¬": {
    "lat": 37.467572112554784,
    "lon": 126.94648519450028
  },
  "ì„œì´ˆêµ¬": {
    "lat": 37.47375670670706,
    "lon": 127.02824862352315
  },
  "ê°•ë‚¨êµ¬": {
    "lat": 37.49500863430103,
    "lon": 127.06447729739476
  },
  "ì†¡íŒŒêµ¬": {
    "lat": 37.505585493847576,
    "lon": 127.11562474009423
  },
  "ê°•ë™êµ¬": {
    "lat": 37.5503441892287,
    "lon": 127.14725283554372
  },
  "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": {
    "lat": 36.55956618377621,
    "lon": 127.26028592082076
  },
  "ìš¸ì£¼êµ°": {
    "lat": 35.548739418527184,
    "lon": 129.18298519280313
  },
  "ë¯¸ì¶”í™€êµ¬": {
    "lat": 37.45254978134102,
    "lon": 126.66399631524844
  },
  "ì—°ìˆ˜êµ¬": {
    "lat": 37.4009921896573,
    "lon": 126.64993493605672
  },
  "ë‚¨ë™êµ¬": {
    "lat": 37.43143986534312,
    "lon": 126.72611321843482
  },
  "ë¶€í‰êµ¬": {
    "lat": 37.49763356643621,
    "lon": 126.7208188462943
  },
  "ê³„ì–‘êµ¬": {
    "lat": 37.5572442708194,
    "lon": 126.73811099103708
  },
  "ê°•í™”êµ°": {
    "lat": 37.71767824101647,
    "lon": 126.43997890004856
  },
  "ì˜¹ì§„êµ°": {
    "lat": 38.41688828537046,
    "lon": 123.72871393725173
  },
  "ëª©í¬ì‹œ": {
    "lat": 34.812716944614664,
    "lon": 126.40455215832884
  },
  "ì—¬ìˆ˜ì‹œ": {
    "lat": 34.77180839117281,
    "lon": 127.65528521137462
  },
  "ìˆœì²œì‹œ": {
    "lat": 34.99447630457818,
    "lon": 127.38999557134534
  },
  "ë‚˜ì£¼ì‹œ": {
    "lat": 34.987417843227256,
    "lon": 126.7213048158046
  },
  "ê´‘ì–‘ì‹œ": {
    "lat": 35.02802399419046,
    "lon": 127.65161482183989
  },
  "ë‹´ì–‘êµ°": {
    "lat": 35.29050729318408,
    "lon": 126.99872419628464
  },
  "ê³¡ì„±êµ°": {
    "lat": 35.21683673776393,
    "lon": 127.264548917215
  },
  "êµ¬ë¡€êµ°": {
    "lat": 35.23796069077802,
    "lon": 127.50451008267986
  },
  "ê³ í¥êµ°": {
    "lat": 34.61162681819536,
    "lon": 127.30806274268446
  },
  "ë³´ì„±êµ°": {
    "lat": 34.8136505937168,
    "lon": 127.16020783679414
  },
  "í™”ìˆœêµ°": {
    "lat": 35.00691278818029,
    "lon": 127.03337673544772
  },
  "ì¥í¥êµ°": {
    "lat": 34.67712003090553,
    "lon": 126.92281874858804
  },
  "ê°•ì§„êµ°": {
    "lat": 34.62316246691055,
    "lon": 126.77113878908828
  },
  "í•´ë‚¨êµ°": {
    "lat": 34.54318580117218,
    "lon": 126.52484023612097
  },
  "ì˜ì•”êµ°": {
    "lat": 34.79892908395468,
    "lon": 126.6282033706885
  },
  "ë¬´ì•ˆêµ°": {
    "lat": 34.95657948704523,
    "lon": 126.42294509641756
  },
  "í•¨í‰êµ°": {
    "lat": 35.11174623509192,
    "lon": 126.53407194047718
  },
  "ì˜ê´‘êµ°": {
    "lat": 35.28018512305113,
    "lon": 126.46237168483232
  },
  "ì¥ì„±êµ°": {
    "lat": 35.329754239139994,
    "lon": 126.76932549930804
  },
  "ì™„ë„êµ°": {
    "lat": 34.35395816317371,
    "lon": 126.8067569307662
  },
  "ì§„ë„êµ°": {
    "lat": 34.45903834913944,
    "lon": 126.24161362945188
  },
  "ì‹ ì•ˆêµ°": {
    "lat": 34.766287625210715,
    "lon": 126.01661363536137
  },
  "ì „ì£¼ì‹œì™„ì‚°êµ¬": {
    "lat": 35.79125243910566,
    "lon": 127.12032639331838
  },
  "ì „ì£¼ì‹œë•ì§„êµ¬": {
    "lat": 35.85836611128281,
    "lon": 127.11295996539803
  },
  "êµ°ì‚°ì‹œ": {
    "lat": 35.95362670889988,
    "lon": 126.7443737203119
  },
  "ìµì‚°ì‹œ": {
    "lat": 36.02213912940299,
    "lon": 126.98932369227764
  },
  "ì •ìì‹œ": {
    "lat": 35.60140092021863,
    "lon": 126.9063570780874
  },
  "ë‚¨ì›ì‹œ": {
    "lat": 35.4227422389565,
    "lon": 127.44519131270307
  },
  "ê¹€ì œì‹œ": {
    "lat": 35.806631311753456,
    "lon": 126.89956022387092
  },
  "ì™„ì£¼êµ°": {
    "lat": 35.92733544437608,
    "lon": 127.23172502709389
  },
  "ì§„ì•ˆêµ°": {
    "lat": 35.82837665077507,
    "lon": 127.43038917104975
  },
  "ë¬´ì£¼êµ°": {
    "lat": 35.93985637256399,
    "lon": 127.71292479404538
  },
  "ì¥ìˆ˜êµ°": {
    "lat": 35.65758995372194,
    "lon": 127.54422713953508
  },
  "ì„ì‹¤êµ°": {
    "lat": 35.595851307940784,
    "lon": 127.23548510615304
  },
  "ìˆœì°½êµ°": {
    "lat": 35.43318214668328,
    "lon": 127.09225142521862
  },
  "ê³ ì°½êµ°": {
    "lat": 35.45016976388217,
    "lon": 126.617665990879
  },
  "ë¶€ì•ˆêµ°": {
    "lat": 35.67904577575091,
    "lon": 126.65393168215302
  },
  "ì œì£¼ì‹œ": {
    "lat": 33.43690726655745,
    "lon": 126.5275428536248
  },
  "ì„œê·€í¬ì‹œ": {
    "lat": 33.3247589974335,
    "lon": 126.5814193223849
  },
  "ì²œì•ˆì‹œë™ë‚¨êµ¬": {
    "lat": 36.76285671728634,
    "lon": 127.22106349717696
  },
  "ì²œì•ˆì‹œì„œë¶êµ¬": {
    "lat": 36.89133588039875,
    "lon": 127.15991121313095
  },
  "ê³µì£¼ì‹œ": {
    "lat": 36.48013100340541,
    "lon": 127.07526448032309
  },
  "ë³´ë ¹ì‹œ": {
    "lat": 36.34376024925245,
    "lon": 126.60358066470836
  },
  "ì•„ì‚°ì‹œ": {
    "lat": 36.807980591986826,
    "lon": 126.9780781633212
  },
  "ì„œì‚°ì‹œ": {
    "lat": 36.78101306907095,
    "lon": 126.4653509723483
  },
  "ë…¼ì‚°ì‹œ": {
    "lat": 36.19161507021065,
    "lon": 127.15959200382568
  },
  "ê³„ë£¡ì‹œ": {
    "lat": 36.29639733338959,
    "lon": 127.23409744669732
  },
  "ë‹¹ì§„ì‹œ": {
    "lat": 36.903428540137526,
    "lon": 126.65288268363548
  },
  "ê¸ˆì‚°êµ°": {
    "lat": 36.11949795650293,
    "lon": 127.4774275852492
  },
  "ë¶€ì—¬êµ°": {
    "lat": 36.24485988467384,
    "lon": 126.85872075276473
  },
  "ì„œì²œêµ°": {
    "lat": 36.1086701278833,
    "lon": 126.70587754361448
  },
  "ì²­ì–‘êµ°": {
    "lat": 36.429944989673146,
    "lon": 126.85043582291672
  },
  "í™ì„±êµ°": {
    "lat": 36.56977359648989,
    "lon": 126.62416591391433
  },
  "ì˜ˆì‚°êµ°": {
    "lat": 36.67121358707068,
    "lon": 126.78316762079383
  },
  "íƒœì•ˆêµ°": {
    "lat": 36.876597834635625,
    "lon": 126.21257450315706
  },
  "ìƒë‹¹êµ¬": {
    "lat": 36.59457486050864,
    "lon": 127.5866844432612
  },
  "ì„œì›êµ¬": {
    "lat": 36.54712693515592,
    "lon": 127.4398223100628
  },
  "í¥ë•êµ¬": {
    "lat": 36.64728717277419,
    "lon": 127.36945304046684
  },
  "ì²­ì›êµ¬": {
    "lat": 36.72106598414242,
    "lon": 127.4915211803271
  },
  "ì¶©ì£¼ì‹œ": {
    "lat": 37.01297816188485,
    "lon": 127.89434787829916
  },
  "ì œì²œì‹œ": {
    "lat": 37.05934659325082,
    "lon": 128.1413213779792
  },
  "ë³´ì€êµ°": {
    "lat": 36.48943538388814,
    "lon": 127.72625168222108
  },
  "ì˜¥ì²œêµ°": {
    "lat": 36.32018550243811,
    "lon": 127.65751363249878
  },
  "ì˜ë™êµ°": {
    "lat": 36.15921351501756,
    "lon": 127.81014273456776
  },
  "ì¦í‰êµ°": {
    "lat": 36.78559015021481,
    "lon": 127.60564013659555
  },
  "ì§„ì²œêµ°": {
    "lat": 36.86943906186885,
    "lon": 127.44356748731671
  },
  "ê´´ì‚°êµ°": {
    "lat": 36.76657974619426,
    "lon": 127.8275782644069
  },
  "ìŒì„±êµ°": {
    "lat": 36.97438578796661,
    "lon": 127.61566647572856
  },
  "ë‹¨ì–‘êµ°": {
    "lat": 36.99500218415685,
    "lon": 128.38871042193472
  }                        
                }
                return coords_dict
            except Exception as e:
                st.error(f"ì‹œêµ°êµ¬ ì¢Œí‘œ ë¡œë“œ ì¤‘ ì˜¤ë¥˜: {e}")
                return {}
            
        coords_dict = load_sigungu_coordinates()
            
        if coords_dict:
            # í‚¤ì›Œë“œì—ì„œ ì§€ëª… ì¶”ì¶œ ë° ë¹ˆë„ìˆ˜ ê³„ì‚°
            def get_location_frequency(keywords_series, coords_dict):
                """í‚¤ì›Œë“œ ì‹œë¦¬ì¦ˆì—ì„œ ì§€ëª… ë¹ˆë„ìˆ˜ë¥¼ ê³„ì‚°"""
                location_counts = defaultdict(int)

                # ëª¨ë“  ì‹œêµ°êµ¬ëª…ì—ì„œ ì ‘ë¯¸ì‚¬ë¥¼ ì œê±°í•œ ê¸°ë³¸ ì´ë¦„ë§Œ ì €ì¥
                base_names = {loc: loc.replace('ì‹œ', '').replace('êµ°', '').replace('êµ¬', '') 
                  for loc in coords_dict.keys()}
    
                for keywords in keywords_series.dropna():
                    if not isinstance(keywords, str):
                        continue
            
                # í•œêµ­ì–´ í‚¤ì›Œë“œë¥¼ ë‹¤ì–‘í•œ êµ¬ë¶„ìë¡œ ë¶„ë¦¬
                for kw in re.split(r'[\s,;:/()]+', keywords.strip()):
                    kw = kw.strip()
                    if not kw or len(kw) < 2:
                        continue
                
                # ì ‘ë¯¸ì‚¬ ì œê±°í•œ í‚¤ì›Œë“œë¡œ ë¹„êµ
                kw_base = kw.replace('ì‹œ', '').replace('êµ°', '').replace('êµ¬', '')
            
                # ëª¨ë“  ì‹œêµ°êµ¬ëª…ê³¼ ë¹„êµ
                for location, base_name in base_names.items():
                    if base_name in kw_base:
                        # ì •í™•í•œ ë§¤ì¹˜ëŠ” ë” ë†’ì€ ê°€ì¤‘ì¹˜ ë¶€ì—¬
                        if kw_base == base_name:
                            location_counts[location] += 3
                        else:
                            location_counts[location] += 1
                        break

                return location_counts
                
            # ì§€ëª… ë¹ˆë„ìˆ˜ ê³„ì‚°
            location_counts = get_location_frequency(display_df['í‚¤ì›Œë“œ'], coords_dict)
    
            if location_counts and sum(location_counts.values()) > 0:
                # íˆíŠ¸ë§µ ìƒì„±
                def create_heatmap(location_counts, coords_dict):
                    """ì§€ëª… ë¹ˆë„ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íˆíŠ¸ë§µ ìƒì„±"""
                    # ë°ì´í„°í”„ë ˆì„ ìƒì„±
                    df_locations = pd.DataFrame({
                        'location': list(location_counts.keys()),
                        'count': list(location_counts.values())
                        })
                        
                    # ì¢Œí‘œ ì¶”ê°€
                    df_locations['lat'] = df_locations['location'].apply(
                        lambda x: coords_dict.get(x, (None, None))[0] if x in coords_dict else None
                    )
                    df_locations['lon'] = df_locations['location'].apply(
                        lambda x: coords_dict.get(x, (None, None))[1] if x in coords_dict else None
                        )
                        
                    # ì¢Œí‘œê°€ ì—†ëŠ” í–‰ ì œê±°
                    df_locations = df_locations.dropna(subset=['lat', 'lon'])
                        
                    if df_locations.empty:
                        st.warning("ìœ íš¨í•œ ì¢Œí‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
                        return None
                        
                    # ì§€ë„ ìƒì„± (í•œêµ­ ì¤‘ì‹¬)
                    m = folium.Map(location=[36.5, 127.5], zoom_start=7, tiles='cartodbpositron')
                        
                    # íˆíŠ¸ë§µ ë°ì´í„° ì¤€ë¹„
                    heat_data = [[row['lat'], row['lon'], row['count']] for _, row in df_locations.iterrows()]
                        
                    # íˆíŠ¸ë§µ ì¶”ê°€
                    HeatMap(heat_data, radius=15, blur=10).add_to(m)
                        
                    # ìƒìœ„ 10ê°œ ì§€ëª…ì— ë§ˆì»¤ ì¶”ê°€
                    top_locations = df_locations.nlargest(10, 'count')
                    for _, row in top_locations.iterrows():
                        folium.CircleMarker(
                            location=[row['lat'], row['lon']],
                            radius=row['count']/max(df_locations['count'])*10 + 5,
                            popup=f"{row['location']}: {row['count']}ê±´",
                            color='blue',
                            fill=True,
                            fill_opacity=0.4
                            ).add_to(m)
                        
                    return m
                    
                # íˆíŠ¸ë§µ ìƒì„± ë° í‘œì‹œ
                st.markdown("### ğŸ—ºï¸ ì§€ëª… ë¹ˆë„ìˆ˜ íˆíŠ¸ë§µ")
                heatmap = create_heatmap(location_counts, coords_dict)
                if heatmap:
                    folium_static(heatmap, width=800, height=600)
                    
                # ìƒìœ„ 20ê°œ ì§€ëª… í‘œì‹œ
                st.markdown("### ğŸ“Š ì§€ëª… ë¹ˆë„ìˆ˜ Top 20")
                df_top = pd.DataFrame({
                    'ì§€ëª…': list(location_counts.keys()),
                    'ë¹ˆë„ìˆ˜': list(location_counts.values())
                    }).sort_values('ë¹ˆë„ìˆ˜', ascending=False).head(20)
                    
                # ë¹ˆë„ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ê·¸ë¼ë°ì´ì…˜ ì ìš©
                st.dataframe(
                    df_top.style.background_gradient(cmap='YlOrRd', subset=['ë¹ˆë„ìˆ˜']),
                    use_container_width=True
                    )
            else:
                st.warning("í‚¤ì›Œë“œì—ì„œ ì¸ì‹ëœ ì§€ëª…ì´ ì—†ìŠµë‹ˆë‹¤.")
            
        # ì—°ë„ë³„ ê¸°ì‚¬ ìˆ˜ ë¶„ì„
        st.markdown("---")
        st.header("ğŸ—ºï¸ ë¶„ì„ 1: ì—°ë„ë³„ ê¸°ì‚¬ ìˆ˜ ë¶„ì„")
        
        if 'ì—°ë„' in display_df.columns:
            year_counts = display_df["ì—°ë„"].value_counts().sort_index()
            
            fig1 = px.bar(
                x=year_counts.index,
                y=year_counts.values,
                labels={"x": "ì—°ë„", "y": "ê¸°ì‚¬ ìˆ˜"},
                title="ì—°ë„ë³„ ê¸°ì‚¬ ìˆ˜ ë¶„ì„"
            )
            st.plotly_chart(fig1, use_container_width=True)
        else:
            st.error("'ì—°ë„' ì»¬ëŸ¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.")
            st.stop()
        
        # í‚¤ì›Œë“œ ì›Œë“œí´ë¼ìš°ë“œ ë¶„ì„
        st.markdown("---")
        st.header("â˜ï¸ ë¶„ì„ 2: í‚¤ì›Œë“œ ì›Œë“œí´ë¼ìš°ë“œ")
        
        if 'í‚¤ì›Œë“œ' in display_df.columns:
            # í‚¤ì›Œë“œ ì²˜ë¦¬
            all_keywords = ",".join(display_df["í‚¤ì›Œë“œ"].dropna().astype(str)).split(",")
            filtered_keywords = [kw.strip() for kw in all_keywords if len(kw.strip()) > 1]
            keyword_freq = Counter(filtered_keywords)
            
            # ì›Œë“œí´ë¼ìš°ë“œì— í‘œì‹œí•  ìƒìœ„ í‚¤ì›Œë“œ ìˆ˜ ì¡°ì •
            st.subheader("ì›Œë“œí´ë¼ìš°ë“œ ì„¤ì •")
            top_n = st.slider("í‘œì‹œí•  ìƒìœ„ í‚¤ì›Œë“œ ìˆ˜", 10, 100, 20, 10)
            top_keywords = dict(keyword_freq.most_common(top_n))
            
            # ì›Œë“œí´ë¼ìš°ë“œ ìƒì„±
            try:
                # Try to use a system font for Korean text
                wc = WordCloud(
                    font_path="NanumGothic",  # Try to use system font
                    background_color="white",
                    width=800,
                    height=400
                ).generate_from_frequencies(top_keywords)
            except:
                # Fallback to default font if system font is not available
                wc = WordCloud(
                    background_color="white",
                    width=800,
                    height=400
                ).generate_from_frequencies(top_keywords)
            
            # ì›Œë“œí´ë¼ìš°ë“œ í‘œì‹œ
            st.set_option('deprecation.showPyplotGlobalUse', False)
            plt.figure(figsize=(12, 6))
            plt.imshow(wc, interpolation="bilinear")
            plt.axis("off")
            st.pyplot()
        else:
            st.warning("ì—…ë¡œë“œí•œ íŒŒì¼ì— 'í‚¤ì›Œë“œ' ì—´ì´ ì—†ìŠµë‹ˆë‹¤.")
            
        # ê¸°ê´€ ë„¤íŠ¸ì›Œí¬ ë¶„ì„
        st.markdown("---")
        st.header("ğŸ•¸ï¸ ë¶„ì„ 3: ê¸°ê´€ ë„¤íŠ¸ì›Œí¬ ë¶„ì„")
        
        if 'ê´€ë ¨ê¸°ê´€' in display_df.columns:
            # ê¸°ê´€ ë„¤íŠ¸ì›Œí¬ ë¶„ì„
            co_occurrence = Counter()
            for row in display_df["ê´€ë ¨ê¸°ê´€"].dropna():
                orgs = list(set([o.strip() for o in str(row).split(",") if len(o.strip()) > 1]))
                for i in range(len(orgs)):
                    for j in range(i+1, len(orgs)):
                        edge = tuple(sorted([orgs[i], orgs[j]]))
                        co_occurrence[edge] += 1
            
            # ë™ì‹œì¶œí˜„ 2íšŒ ì´ìƒë§Œ í•„í„°ë§
            filtered_edges = {pair: w for pair, w in co_occurrence.items() if w >= 2}
            
            G = nx.Graph()
            for (a, b), weight in filtered_edges.items():
                G.add_edge(a, b, weight=weight)
            
            if len(G.nodes()) > 0:
                # ìƒìœ„ ë…¸ë“œ ìˆ˜ ì¡°ì ˆ ìŠ¬ë¼ì´ë”
                max_nodes = min(30, len(G.nodes()))  # ìµœëŒ€ 50ê°œ ë…¸ë“œë¡œ ì œí•œ
                node_count = st.slider("ë¶„ì„í•  ìƒìœ„ ê¸°ê´€ ìˆ˜", 5, max_nodes, min(20, max_nodes), 1)
                
                # ì„ íƒí•œ ë…¸ë“œ ìˆ˜ë§Œí¼ ìƒìœ„ ë…¸ë“œ í•„í„°ë§
                top_nodes = sorted(G.degree, key=lambda x: x[1], reverse=True)[:node_count]
                G_filtered = G.subgraph([n for n, _ in top_nodes])
                
                st.write(f"ì„ íƒëœ ê¸°ê´€ ìˆ˜: {len(G_filtered.nodes())}")
                st.write(f"ì—°ê²° ìˆ˜: {len(G_filtered.edges())}")
                
                # ë…¸ë“œ ìœ„ì¹˜ ê³„ì‚°
                pos = nx.spring_layout(G_filtered, seed=42)
                
                # ì—£ì§€ ì¢Œí‘œ ì¶”ì¶œ
                edge_x, edge_y = [], []
                for edge in G_filtered.edges():
                    x0, y0 = pos[edge[0]]
                    x1, y1 = pos[edge[1]]
                    edge_x += [x0, x1, None]
                    edge_y += [y0, y1, None]
                
                # ì—£ì§€ íŠ¸ë ˆì´ìŠ¤
                edge_trace = go.Scatter(
                    x=edge_x, y=edge_y,
                    line=dict(width=0.5, color="#888"),
                    hoverinfo='none',
                    mode='lines'
                )
                
                # ë…¸ë“œ íŠ¸ë ˆì´ìŠ¤
                node_x, node_y, node_text = [], [], []
                for node in G_filtered.nodes():
                    x, y = pos[node]
                    node_x.append(x)
                    node_y.append(y)
                    node_text.append(f"{node}<br>ì—°ê²° ìˆ˜: {G_filtered.degree[node]}")
                
                node_trace = go.Scatter(
                    x=node_x, y=node_y,
                    mode='markers+text',
                    text=[node[:10] + '...' if len(node) > 10 else node for node in G_filtered.nodes()],
                    textposition="bottom center",
                    hovertext=node_text,
                    hoverinfo='text',
                    marker=dict(
                        showscale=True,
                        colorscale='YlGnBu',
                        size=10,
                        color=[G_filtered.degree[node] for node in G_filtered.nodes()],
                        colorbar=dict(
                            thickness=15,
                            title='ì—°ê²° ìˆ˜',
                            xanchor='left',
                            titleside='right'
                        ),
                        line_width=2
                    )
                )
                
                # ë„¤íŠ¸ì›Œí¬ ê·¸ë˜í”„ ìƒì„±
                fig = go.Figure(
                    data=[edge_trace, node_trace],
                    layout=go.Layout(
                        showlegend=False,
                        hovermode='closest',
                        margin=dict(b=20,l=5,r=5,t=40),
                        xaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
                        yaxis=dict(showgrid=False, zeroline=False, showticklabels=False)
                    )
                )
                
                st.plotly_chart(fig, use_container_width=True)
            else:
                st.warning("ë„¤íŠ¸ì›Œí¬ë¥¼ ìƒì„±í•  ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        else:
            st.warning("ì—…ë¡œë“œí•œ íŒŒì¼ì— 'ê´€ë ¨ê¸°ê´€' ì—´ì´ ì—†ìŠµë‹ˆë‹¤.")
            
        st.error(f"ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
        st.stop()

# ìŠ¤íƒ€ì¼ ì„¤ì •
st.markdown("""
    <style>
    .main .block-container {
        padding-top: 2rem;
        padding-bottom: 2rem;
    }
    .stDataFrame {
        width: 100%;
    }
    </style>
""", unsafe_allow_html=True)